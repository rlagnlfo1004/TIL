## MPP(Massively Parallel Processing)
대규모 병렬 처리

MPP는 말 그대로 **'대규모로 병렬 처리한다'**는 의미를 가집니다. 이는 하나의 큰 작업을 여러 개의 작은 조각으로 나누어, 독립적으로 동작하는 수많은 프로세서(또는 서버)들이 이 조각들을 동시에 처리하도록 하는 아키텍처입니다.

책 속에서는 대규모 분석 시스템 구축에서 데이터 마트의 설계 과정 속에서의 중요한 metric(평가지표)인 latency를 줄일 수 있는 방법 중 하나로서 MPP 아키텍처가 소개되었습니다.

<br><br>

## 🔍 MPP의 기본 개념 및 작동 방식

MPP 시스템은 여러 대의 독립적인 **서버(노드, Node)**들로 구성됩니다. 각 노드는 자체적인 CPU, 메모리, 디스크를 가지고 있으며, 서로 MPI(메세지 패싱)와 같은 표준을 사용하여 메세지를 전달함으로써 네트워크로 연결되어 있습니다.

- **독립된 자원:** 각 노드는 서로의 자원을 공유하지 않습니다(Nothing Shared Architecture). 이는 특정 노드의 장애가 전체 시스템에 미치는 영향을 최소화하고, 확장이 용이하게 만듭니다.
- **데이터 분산:** 대용량 데이터는 시스템에 들어오는 순간 여러 노드에 **고르게 분산되어 저장**됩니다. 예를 들어, 1TB의 데이터가 10대의 노드에 분산된다면, 각 노드는 약 100GB의 데이터를 저장하게 됩니다. 데이터를 분산할 때는 특정 컬럼(예: 고객 ID, 주문 ID)을 기준으로 해싱(Hashing)하여 데이터가 균등하게 나뉘도록 합니다.
- **쿼리 병렬 처리:** 사용자가 쿼리(예: `SELECT SUM(매출) FROM 판매_테이블 WHERE 지역 = '서울';`)를 요청하면, MPP 시스템은 이 쿼리를 여러 개의 **태스크(Task)**로 분할합니다.
- **동시 실행:** 분할된 서브 쿼리(태스크)들은 데이터를 저장하고 있는 각 노드에서 **동시에 병렬로 실행**됩니다. 각 노드는 자신이 가지고 있는 데이터 부분에 대해서만 쿼리를 처리합니다.
- **결과 통합:** 각 노드에서 처리된 부분 결과들은 최종적으로 **하나의 통합된 결과**로 모여 사용자에게 전달됩니다.

<br><br>

## ⚡️ MPP의 주요 특징 및 장점

MPP 아키텍처는 주로 데이터 분석 및 집계에 최적화되어 있습니다. 대량의 데이터 처리에서 오는 **탁월한 성능** 그리고, 복잡한 조인(Join), 그룹화(Grouping), 정렬(Sorting) 등 데이터 분석에 필요한 다양한 유형의 **복잡한 쿼리 처리 능력**이 있습니다. 추가적으로, 다음과 같은 특징과 장점을 가집니다.

- **선형적 확장성(Linear Scalability):** 데이터 양이 증가하거나 더 빠른 성능이 필요할 때, 단순히 노드를 추가하는 것만으로 시스템의 성능을 **선형적으로 확장**할 수 있습니다. 노드를 추가하면 저장 공간과 처리 능력이 동시에 증가합니다.
- **높은 안정성(High Availability):** 각 노드가 독립적으로 운영되므로, 특정 노드에 장애가 발생하더라도 나머지 노드들이 작업을 계속 수행하거나, 복제된 데이터를 통해 서비스 중단을 최소화할 수 있습니다.
- **비용 효율성:** 고가의 단일 서버를 사용하는 대신, 비교적 저렴한 여러 대의 범용 서버를 조합하여 고성능 시스템을 구축할 수 있어 비용 효율적입니다. 클라우드 환경에서는 더욱 유연하게 자원을 조절할 수 있습니다.
<br><br><br><br>

## 🔨 MPP 데이터베이스에서의 노드

- **마스터 노드 (Master Node):** 사용자의 쿼리를 받아들이고, 쿼리 실행 계획을 수립하며, 이 계획을 여러 세그먼트 노드에 분배하고, 최종적으로 세그먼트 노드들로부터 받은 결과를 취합하여 사용자에게 돌려주는 역할을 합니다. 실제 데이터는 저장하지 않습니다.
- **세그먼트 노드 (Segment Node):** 실제 데이터가 저장되는 노드입니다. 마스터 노드로부터 받은 쿼리 작업을 독립적으로 수행하며, 각 세그먼트 노드는 자체적으로 PostgreSQL과 같은 데이터베이스 인스턴스를 실행합니다. 대부분의 데이터 처리 작업(집계, 조인 등)은 이 세그먼트 노드들에서 병렬로 이루어집니다. 그후, 결과는 마스터 노드로 반환됩니다.

<br><br>

## ⚙️ MPP 시스템의 데이터 복제 및 고가용성 (High Availability)

대규모 시스템인 만큼 **데이터 유실 없이 안정적으로 서비스를 제공**하는 것이 매우 중요합니다. 이를 위해 **데이터 복제**와 **장애 대응 메커니즘**은 MPP 시스템의 핵심적인 요소입니다.
<br><br>
### 1. 데이터 복제 전략: **미러링 (Mirroring) 또는 이중화**

MPP 시스템에서 데이터는 여러 노드에 분산되어 저장되는데, 단순히 분산하는 것만으로는 장애 시 데이터 유실을 막을 수 없습니다. 그래서 대부분의 MPP 시스템은 **데이터 복제(Data Replication)**를 통해 고가용성을 확보합니다.

가장 일반적인 방식은 각 노드에 저장된 데이터 세그먼트(Segment)의 복사본을 **다른 노드에 저장**하는 것입니다. 예를 들어, 노드 A가 데이터 조각 1을 가지고 있다면, 노드 B는 데이터 조각 1의 미러(Mirror) 복사본을 가집니다. 이를 통해 장애가 발생한 노드의 역할을 미러 노드가 즉시 대신하여 서비스 중단 시간을 최소화하거나 없앱니다. 또한, 일부 시스템에서는 미러 노드를 읽기 전용 쿼리 처리에도 활용하여 전체적인 읽기 성능을 높일 수 있습니다.
<br><br>

### 2. 장애 감지: **상태 모니터링 (Health Monitoring)**

데이터 복제가 준비되어 있더라도, 시스템이 장애를 신속하게 감지하고 복구하는 메커니즘이 없다면 **고가용성**을 보장할 수 없습니다.

MPP 시스템의 **마스터 노드(Master Node)** 또는 전담 모니터링 컴포넌트는 모든 세그먼트 노드의 상태를 주기적으로 확인합니다. 주로 **하트비트(Heartbeat)** 메시지(노드가 살아있음을 알리는 주기적인 신호)를 주고받거나, 각 노드의 자원 사용률(CPU, 메모리, 디스크 I/O)을 감시합니다.
<br><br>

### 3. 복구 메커니즘: **자동 페일오버 (Automatic Failover)**

장애가 감지되면, 시스템은 자동으로 해당 노드의 역할을 **미러 노드나 다른 건강한 노드에게 넘겨줍니다.** 이 과정을 **페일오버**라고 합니다. 예를 들어, 마스터 노드 장애 시 스탠바이 마스터(Standby Master)가 역할을 인계받고, 세그먼트 노드 장애 시 해당 세그먼트의 미러가 액티브 세그먼트로 전환됩니다. 이 모든 과정은 애플리케이션이나 사용자에게 거의 투명하게 이루어집니다.
<br><br>
추가로, 장애가 발생했던 노드가 복구되어 시스템에 다시 합류하거나, 새로운 노드가 추가되면, 해당 노드에는 유실되거나 누락된 데이터가 있을 수 있습니다. 이때 시스템은 **자동으로 부족한 데이터를 다른 노드로부터 복사하여 재동기화**합니다. 이 과정은 시스템의 전반적인 성능에 영향을 미치지 않도록 백그라운드에서 점진적으로 진행됩니다.